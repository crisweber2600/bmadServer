---
name: lens-configure
description: Configure LENS detection rules and settings
---

# Lens Configure Workflow

**Goal:** Set up or modify LENS configuration for project-specific needs.

## Configuration Levels

| Level | File | Purpose |
|-------|------|---------|
| None | ‚Äî | Auto-detection only |
| Minimal | `_lens/lens-config.yaml` | Custom branch patterns |
| Standard | + `_lens/domain-map.yaml` | Service/microservice mapping |
| Full | + `_lens/services/*.yaml` | Complete service definitions |

## Execution Steps

### 1. Detect Current State

Check what configuration exists:

```yaml
current_config:
  lens_config: {exists: true/false, valid: true/false}
  domain_map: {exists: true/false, valid: true/false}
  service_configs: {count: N}
  auto_discovered: {services: N, microservices: M}
```

### 2. Choose Configuration Mode

```yaml
config_mode:
  prompt: "How would you like to configure LENS?"
  options:
    - minimal: "Minimal ‚Äî Just branch patterns (quick setup)"
    - standard: "Standard ‚Äî Branch patterns + domain map (recommended)"
    - full: "Full ‚Äî Complete service definitions"
    - edit: "Edit existing configuration"
    - reset: "Reset to defaults"
```

---

## Mode: Minimal

### Create lens-config.yaml

```yaml
prompt_sequence:
  - use_default_branch_patterns:
      prompt: "Use default branch patterns?"
      options:
        - yes: "Use defaults (main‚ÜíDomain, service/*‚ÜíService, feature/*‚ÜíFeature)"
        - no: "Customize patterns"

  - notification_level:
      prompt: "Notification verbosity:"
      options:
        - silent: "Silent ‚Äî Only errors"
        - smart: "Smart ‚Äî Meaningful transitions (recommended)"
        - verbose: "Verbose ‚Äî All activity"

  - auto_restore:
      prompt: "Auto-restore previous session context?"
      default: true
```

Generate `_lens/lens-config.yaml`:

```yaml
# LENS Configuration
# Generated by lens-configure

branch_patterns:
  domain:
    - main
    - master
    - develop
    - "release/*"
    - "hotfix/*"
  service:
    - "service/{name}"
  feature:
    - "feature/{service}/{microservice}/{name}"
    - "feature/{microservice}/{name}"
    - "feature/{name}"

notifications:
  level: {notification_level}

session:
  auto_restore: {auto_restore}

discovery:
  enabled: true
```

---

## Mode: Standard

Run minimal configuration first, then:

### Create domain-map.yaml

```yaml
prompt_sequence:
  - auto_discover:
      prompt: "Auto-discover project structure?"
      default: true

  - domain_name:
      prompt: "Project/domain name:"
      default: "{repo_name}"

  - domain_description:
      prompt: "Brief project description:"
```

If auto-discover enabled:
1. Scan project structure
2. Present discovered services
3. Allow user to confirm/edit
4. Generate domain-map.yaml

If manual:
1. Prompt for each service
2. Prompt for microservices per service
3. Generate domain-map.yaml

---

## Mode: Full

Run standard configuration first, then:

### Create Service Definitions

For each service, create `_lens/services/{service}/service.yaml`:

```yaml
prompt_sequence:
  - service_description:
      prompt: "Description for {service}:"
  
  - service_owner:
      prompt: "Owner/team for {service}:"
  
  - service_docs:
      prompt: "Key documentation paths (comma-separated):"
      default: "README.md"
```

Generate:

```yaml
# Service Definition: {service}
name: {service}
description: "{service_description}"
owner: {service_owner}

microservices:
{for each microservice}
  - name: {microservice}
    path: services/{service}/{microservice}
    description: "_TBD_"
{end for}

dependencies: []

docs:
{for each doc}
  - {doc_path}
{end for}
```

---

## Mode: Edit

### Select What to Edit

```yaml
edit_target:
  prompt: "What would you like to edit?"
  options:
    - branch_patterns: "Branch detection patterns"
    - notifications: "Notification settings"
    - discovery: "Auto-discovery settings"
    - domain_map: "Domain map (services/microservices)"
    - service: "Specific service configuration"
```

### Present Current Values

Show current configuration with option to modify each field.

### Save Changes

Update appropriate files with new values.

---

## Mode: Reset

```yaml
reset_options:
  prompt: "Reset configuration?"
  options:
    - defaults: "Reset to defaults (keep domain-map)"
    - clean: "Remove all LENS configuration"
  
  confirm:
    prompt: "This will {action}. Are you sure?"
```

---

## Advanced Options

### Custom Lens Definition

```yaml
custom_lenses:
  - name: component
    icon: üß©
    level: "between microservice and feature"
    pattern: "components/{name}/"
    context_files:
      - "components/{name}/README.md"
```

### Detection Priority

```yaml
detection_priority:
  prompt: "Detection priority:"
  options:
    - git_first: "Check branch first, then directory"
    - directory_first: "Check directory first, then branch"
    - auto: "Smart detection based on project"
```

### Activation Conditions

```yaml
activation_conditions:
  prompt: "When should LENS activate?"
  options:
    - always: "Always active"
    - multi_service: "Only for multi-service projects"
    - explicit: "Only when _lens/ exists"
```

---

## Output Summary

```
‚úÖ LENS Configuration Complete

üìÇ Created:
   _lens/lens-config.yaml
   _lens/domain-map.yaml (if standard+)
   _lens/services/*.yaml (if full)

‚öôÔ∏è Settings:
   Detection: {detection_mode}
   Notifications: {notification_level}
   Auto-restore: {auto_restore}

üìä Project:
   Services: {service_count}
   Microservices: {microservice_count}

üß≠ LENS is now configured for your project!
```

---

## Validation

Before saving:
- Validate YAML syntax
- Check branch patterns are valid regex
- Verify referenced paths exist
- Warn about potential conflicts
