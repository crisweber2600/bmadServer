using bmadServer.ApiService.Data.Entities;
using Xunit;

namespace bmadServer.Tests.Unit;

public class UserEntityTests
{
    [Fact]
    public void User_ShouldHaveRequiredProperties()
    {
        // Arrange & Act
        var user = new User
        {
            Email = "test@example.com",
            PasswordHash = "hashed_password",
            DisplayName = "Test User"
        };

        // Assert
        Assert.NotEqual(Guid.Empty, user.Id);
        Assert.Equal("test@example.com", user.Email);
        Assert.Equal("hashed_password", user.PasswordHash);
        Assert.Equal("Test User", user.DisplayName);
        Assert.NotEqual(default(DateTime), user.CreatedAt);
    }

    [Fact]
    public void User_IdShouldBeAutoGenerated()
    {
        // Arrange & Act
        var user1 = new User
        {
            Email = "user1@example.com",
            PasswordHash = "hash1",
            DisplayName = "User 1"
        };
        var user2 = new User
        {
            Email = "user2@example.com",
            PasswordHash = "hash2",
            DisplayName = "User 2"
        };

        // Assert
        Assert.NotEqual(Guid.Empty, user1.Id);
        Assert.NotEqual(Guid.Empty, user2.Id);
        Assert.NotEqual(user1.Id, user2.Id);
    }

    [Fact]
    public void User_CreatedAtShouldBeSetToUtcNow()
    {
        // Arrange
        var beforeCreation = DateTime.UtcNow.AddSeconds(-1);
        
        // Act
        var user = new User
        {
            Email = "test@example.com",
            PasswordHash = "hash",
            DisplayName = "Test User"
        };
        var afterCreation = DateTime.UtcNow.AddSeconds(1);

        // Assert
        Assert.InRange(user.CreatedAt, beforeCreation, afterCreation);
    }
}
