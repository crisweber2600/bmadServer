---
name: domain-map
description: Generate or update the domain overview
---

# Domain Map Workflow

**Goal:** Generate, view, or update the domain overview that shows all services, microservices, and their relationships.

## Use Cases

1. **Generate** â€” Create initial domain-map.yaml from project structure
2. **View** â€” Display current domain map in readable format
3. **Update** â€” Sync domain map with actual project structure
4. **Visualize** â€” Generate diagram of service relationships

## Execution Steps

### 1. Detect Mode

```yaml
mode:
  prompt: "What would you like to do with the domain map?"
  options:
    - generate: "Generate new domain map from project structure"
    - view: "View current domain map"
    - update: "Update domain map (sync with project)"
    - visualize: "Generate relationship diagram"
```

---

## Mode: Generate

### 1.1 Scan Project Structure

Scan for service directories:

```bash
# Common patterns to check
services/*/
apps/*/
src/*/
packages/*/
```

For each directory, look for indicators:
- `service.yaml` or `package.json` or `*.csproj`
- `README.md` with service description
- Subdirectories that look like microservices

### 1.2 Gather Project Info

```yaml
domain_name:
  prompt: "Project/domain name:"
  default: "{git_repo_name}"

domain_description:
  prompt: "Brief project description:"
  default: "_{extracted from README.md if available}_"
```

### 1.3 Confirm Discovered Structure

Present discovered structure:

```
ğŸ“Š Discovered Project Structure:

Services (3):
  ğŸ“¦ identity
     â””â”€â”€ auth-api, token-service, user-profile
  ğŸ“¦ payments
     â””â”€â”€ payment-gateway, billing-service
  ğŸ“¦ notifications
     â””â”€â”€ email-service, push-service

Is this correct? [Y/n/edit]
```

Allow user to edit if needed.

### 1.4 Generate domain-map.yaml

Create `_lens/domain-map.yaml`:

```yaml
# Domain Map
# Generated by LENS on {timestamp}

domain:
  name: "{domain_name}"
  description: "{domain_description}"

services:
{for each service}
  {service_name}:
    description: "{extracted_or_placeholder}"
    owner: "_TBD_"
    microservices:
{for each microservice}
      - name: {microservice_name}
        description: "{extracted_or_placeholder}"
{end for}
{end for}

shared: []

relationships: []
```

---

## Mode: View

### 2.1 Load Domain Map

Load from `_lens/domain-map.yaml` or auto-discover.

### 2.2 Display Overview

**Summary View (default):**

```
ğŸ›°ï¸ Domain: {domain_name}
   {domain_description}

ğŸ“¦ Services ({count}):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ identity                                    @platform   â”‚
â”‚ Authentication and authorization                        â”‚
â”‚ â””â”€â”€ auth-api, token-service, user-profile              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ payments                                    @payments   â”‚
â”‚ Payment processing                                      â”‚
â”‚ â””â”€â”€ payment-gateway, billing-service                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ notifications                               @comms      â”‚
â”‚ User notifications                                      â”‚
â”‚ â””â”€â”€ email-service, push-service                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”— Key Relationships:
   payments â†’ identity (authentication)
   notifications â†’ identity (user lookup)

ğŸ§© Shared Components:
   logging, monitoring, auth-middleware
```

**Detailed View (on request):**
Expand each service to show microservices with descriptions.

---

## Mode: Update

### 3.1 Compare Current vs Actual

Compare `_lens/domain-map.yaml` with actual project structure.

### 3.2 Report Differences

```
ğŸ“Š Domain Map Sync Report

âœ… Matching:
   identity/auth-api
   identity/token-service
   payments/payment-gateway

âš ï¸ In domain-map but not found:
   identity/user-profile
   â†’ Removed or moved?

ğŸ†• Found but not in domain-map:
   identity/admin-api
   notifications/sms-service
   â†’ New additions?

Update domain-map.yaml with these changes? [Y/n/select]
```

### 3.3 Apply Updates

If confirmed:
- Add new services/microservices
- Comment out or remove missing ones (with option)
- Preserve descriptions and owners

---

## Mode: Visualize

### 4.1 Generate Diagram

Create Mermaid diagram of relationships:

```markdown
## Domain Architecture

\`\`\`mermaid
graph TB
    subgraph identity[Identity Service]
        auth-api[Auth API]
        token-service[Token Service]
        user-profile[User Profile]
    end
    
    subgraph payments[Payments Service]
        payment-gateway[Payment Gateway]
        billing-service[Billing Service]
    end
    
    subgraph notifications[Notifications Service]
        email-service[Email Service]
        push-service[Push Service]
    end
    
    billing-service --> auth-api
    email-service --> user-profile
    push-service --> user-profile
\`\`\`
```

### 4.2 Output Options

```yaml
output_format:
  options:
    - mermaid: "Mermaid diagram in markdown"
    - ascii: "ASCII art in terminal"
    - export: "Export to file"
```

---

## Output Summary

### After Generate:
```
âœ… Domain map generated: _lens/domain-map.yaml

ğŸ“Š Summary:
   ğŸ“¦ {service_count} services
   ğŸ˜ï¸ {microservice_count} microservices
   ğŸ”— {relationship_count} relationships

ğŸ’¡ Review and add descriptions to improve context loading.
```

### After View:
(Display the formatted view)

### After Update:
```
âœ… Domain map updated

Changes:
   â• Added: {added_count} items
   â– Removed: {removed_count} items
   ğŸ“ Updated: {updated_count} items
```

### After Visualize:
```
ğŸ“Š Diagram generated

View: {output_location}
Format: {format}
```

---

## Integration

- **lens-detect** uses domain-map for validation
- **context-load** uses domain-map for file paths
- **impact-analysis** uses relationships from domain-map
- **new-service** updates domain-map on creation
